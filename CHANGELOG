# 變更日誌

## 2025-09-09 - 外部 LLM 評估系統整合

### 重大功能更新
- 🚀 **全新 LLM 評估系統**：整合外部 ngrok LLM 服務，提供專業級 GPT 回答品質評估
- 🧠 **智能化評估替代**：移除舊有的關鍵詞評估系統，改用專業 AI 稽核評估
- ⚡ **Service Worker 架構**：採用 Manifest V3 背景服務，避免 CORS 限制
- 🎯 **精確評估標準**：問題解決狀態（是/否/部分/未知）+ 回答正確率（0-100%）

### 技術架構改進
- 📡 **外部 API 整合**：串接 `https://blowfish-absolute-absolutely.ngrok-free.app/api/generate`
- 💾 **智能快取系統**：單頁記憶體快取，避免同一頁面生命週期內的重複評估
- 🔄 **非同步處理**：LLM 評估採用非同步載入，不影響主要功能；支援批次評估 API 與進度回報（目前 UI 未開啟）
- 🛡️ **錯誤處理機制**：評估失敗時自動回退至預設值（未知/0%）

### 評估品質提升
- 📊 **專業稽核標準**：採用客服品質稽核 AI 的專業評估邏輯
- 🎯 **四級解決狀態**：是（完全解決）、部分（部分解決）、否（未解決）、未知（無法判斷）
- 📈 **精確正確率**：0-100% 數值化評估，更精準反映回答品質
- 🔍 **上下文分析**：同時分析用戶問題與 GPT 回答的關聯性

### 使用者體驗優化
- ⏰ **即時更新**：評估結果即時顯示在詳細 log 表格中
- 💡 **視覺化呈現**：解決狀態與正確率以直觀方式呈現
- 🔄 **背景處理**：評估過程在背景進行，不影響其他操作
- 📱 **響應式設計**：評估結果適配所有螢幕尺寸

### 檔案異動
- `extension/background.js` - 全新建立，LLM API 整合
- `extension/content.js` - 移除關鍵詞評估，整合 LLM 評估
- `extension/manifest.json` - 更新權限，支援外部 API 呼叫
- `extension/styles.css` - 優化評估結果顯示樣式

### 已知差異與限制（相較於先前文件敘述）
- 快取為「單頁記憶體」層級，重新整理頁面後不保留
- KPI 的「本週查詢總數」以 User 提問數為基礎（問答對為 1 筆），不累加 GPT 行數
- 平均正確率以總查詢數為分母，尚在審核或缺乏數值者不進入分子
- 批次評估 API 與進度回報已在背景實作，但尚未在 UI 露出
- PM 匯出範本函式 `exportPmTemplateCSV` 已存在，尚未在 UI 露出

## 2025-09-04 - 按鈕顯示修正

### 修正問題
- 🔧 **修正按鈕顯示問題**：優化面板寬度和按鈕布局
- 📱 **改善響應式布局**：按鈕支援自動換行，避免顯示異常
- 🎨 **美化按鈕樣式**：不同類型按鈕使用不同顏色區分功能

### 改進詳情
- 將面板寬度從 420px 增加到 480px，提供更多空間
- 簡化按鈕文字：
  - "聚合全部頁" → "聚合全頁"
  - "匯出 CSV" → "匯出CSV"
  - "每日人次" → "每日統計"
  - "時段分佈" → "時段分析"
  - "使用log" → "詳細log"
- 調整按鈕順序：將切換按鈕放在前面，操作按鈕放在後面
- 新增按鈕分類樣式：
  - 🔵 切換按鈕（藍色系）
  - 🟡 操作按鈕（天藍色系）
  - 🔴 關閉按鈕（紅色系）

### 技術改進
- 使用 flexbox 和 gap 屬性優化按鈕間距
- 支援按鈕自動換行，避免溢出問題
- 改善按鈕的 hover 和 active 狀態視覺回饋

## 2025-09-04 - 表格按鈕切換功能改進

### 新增功能
- 🎯 **每種表格都像"摘要_KPI"一樣，按按鈕顯示**
- 新增了四個切換按鈕：
  - `KPI摘要` - 顯示/隱藏 KPI 指標摘要表格
  - `每日人次` - 顯示/隱藏每日唯一使用人次表格  
  - `時段分佈` - 顯示/隱藏 24 小時使用時段分佈表格
  - `使用log` - 顯示/隱藏詳細的使用記錄表格

### 介面改進
- ✨ 每個表格都有獨立的切換按鈕控制顯示/隱藏
- 🎨 按鈕有視覺回饋 - 激活狀態會變藍色
- 📱 一次只能顯示一個表格，保持介面整潔
- 🚀 預設顯示 KPI 摘要表格，提供最重要的概覽資訊

### 技術詳情
- 重構了面板的 HTML 結構，將每個表格封裝在獨立的 section 中
- 新增了統一的按鈕狀態管理函數
- 改進了 CSS 樣式，增加按鈕的 hover 和 active 狀態
- 保持所有原有功能完整性（數據聚合、CSV 匯出等）

### 使用說明
1. 點擊任何一個表格按鈕來顯示對應的數據
2. 再次點擊相同按鈕或點擊其他按鈕可以隱藏/切換表格
3. 所有原有功能（聚合全部頁、匯出 CSV）保持不變

### 檔案異動
- `extension/content.js` - 主要邏輯更新
- `extension/styles.css` - 按鈕樣式改進
- `extension/manifest.json` - 無異動

## 2025-08-28 - 核心功能建立

### 初始版本功能
- 📊 **基礎統計功能**：每日唯一使用人數統計
- 📈 **KPI 摘要系統**：週間關鍵績效指標計算
- 🔄 **多頁聚合**：支援跨頁面數據聚合
- 💾 **CSV 匯出**：完整的數據匯出功能
- 🎨 **浮動面板設計**：右下角統計面板，支援拖拽移動
- 📱 **響應式設計**：適配不同螢幕尺寸

### 統計功能
- 📊 每日唯一使用人次統計（去重處理）
- ⏰ 24小時使用時段分佈分析
- 📈 週活躍用戶數 (WAU) 計算
- 📊 日活平均用戶數 (DAU) 統計
- 🎯 高峰時段識別與統計

### 品質評估系統 (v1.0)
- 🔍 **關鍵詞評估系統**：基於內容關鍵詞分析回答品質
- ✅ **解決狀態判斷**：是/否/部分/未知四級評估
- 📈 **回答正確率**：0-100% 評估標準
- 🔗 **問答配對機制**：智能配對用戶問題與GPT回答
- 📊 **品質指標統計**：解決率、平均正確率等KPI計算

### 技術特色
- 🎯 **排除名單機制**：自動排除測試帳號和相關人員
- 🗓️ **智能日期處理**：自動週間範圍計算（週一至週五）
- 💾 **本地儲存**：支援自訂日期範圍儲存
- 🎨 **面板拖拽**：可拖拽移動的浮動面板
- 📊 **多表格切換**：KPI摘要、每日統計、時段分析、詳細log

### 檔案結構
- `extension/content.js` - 主要邏輯與統計算法
- `extension/styles.css` - 面板樣式與響應式設計
- `extension/manifest.json` - 擴充功能配置
