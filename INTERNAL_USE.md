# INTERNAL_USE / 內部使用說明

> 本文件界定此瀏覽器擴充功能於公司內部分析場景的合法、合規、安全與維運邊界。若與 README 或實作行為不一致，請以最新程式碼與 CHANGELOG 為準，並回報修正。

## 1. 授權與使用範圍
- 此工具僅供公司/部門內部營運分析、服務品質監測與產品改進使用。
- 未經授權不得：
  - 對外散佈、公開上架瀏覽器市集、或授權第三方使用。
  - 用於商業銷售、競品比較、或與原目的無關之資料蒐集。
- 開源/對外分享需先通過：主管 + 資訊安全單位審核，並補充 LICENSE 與去識別化作業。

## 2. 資料來源與處理邊界
- 僅讀取 MIS Bot 指定頁面 (`/pms/platformAnalysis/UserChat*`) 之現有可視 / data-* 屬性資料；不主動探勘其他路徑。
- 不讀取：Cookies、LocalStorage 內非本系統 key、跨網域資源、使用者輸入框未送出的暫存內容。
- 不上傳任何原始使用者資料至第三方（唯一例外：LLM 評估 API，僅傳送必要片段）。
- 不持久儲存完整原始對話於遠端；所有統計計算於使用者瀏覽器記憶體即時完成。

## 3. 個資 / 隱私保護
- userId 僅做統計去重與 KPI 計算，不進行交叉比對或再識別。
- 若後續引入長期儲存（IndexedDB /匯出報表），需落實：
  - 去識別化（雜湊 / 代碼化）
  - 最低必要原則（移除不參與分析欄位）
  - 保存期限政策（預設 <= 90 天，延長需備案）
- 匯出 CSV 僅供內部分析傳遞，不得直接貼附於外部客戶簡報或公開社群。

## 4. 第三方 LLM 評估使用準則
- 目前端點：`https://blowfish-absolute-absolutely.ngrok-free.app/api/generate`
- 僅傳送：問題文字、回答文字、必要的評估上下文；不得包含：機敏個資、密鑰、憑證、帳戶密碼等。
- 若將來改為正式商用服務，需：
  - 評估供應商 DPA / SLA
  - 加入逾時與重試（指數退避）
  - 加入輸出 Schema 驗證，阻擋非預期 JSON
  - Logging 避免原文落地（或加密遮罩）

## 5. 安全控制要求
| 項目 | 狀態 | 說明 |
|------|------|------|
| 最小權限 (Least Privilege) | 已實作 | manifest 僅列出必要 host_permissions |
| 外部 API 白名單 | 已實作 | 只允許 MIS Bot 與 LLM 端點 |
| 請求逾時/重試 | 待實作 | README Roadmap 已列 | 
| Schema 驗證 | 待實作 | 用於 LLM 回傳與匯出前檢查 |
| 異常告警 | 規劃中 | KPI 閾值與 API 失敗比率 |
| IndexedDB 快取 | 規劃中 | 導入時需加 versioned schema |
| 安全稽核紀錄 | 未實作 | 視需要新增簡易 in-memory audit log |

## 6. 變更管理
- 所有功能性 / 欄位 / 權限調整需更新：CHANGELOG + README 對應章節。
- 安全/隱私相關新增：需在 CHANGELOG 明確列出「安全影響評估」。
- 若調整 host_permissions 或引入新的外部服務，需完成安全檢核（PoC→審核→發布）。

## 7. 風險與緩解摘要
| 風險 | 類型 | 緩解措施 |
|------|------|----------|
| 外部 LLM 端點不可用 | 可用性 | 快取 + 逾時後回退預設評估值 |
| 評估結果格式異常 | 完整性 | JSON Schema 驗證 + 預設降級 |
| 大量資料聚合造成瀏覽器卡頓 | 效能 | 分批處理 / 限制日期範圍 / 延遲評估 |
| 使用者誤將匯出檔外流 | 隱私 | 加上檔頭警語 / 內部傳輸指引 |
| 新增權限未揭露 | 合規 | PR Template + 發布前清單核對 |
| 問答對不準確配對影響 KPI | 品質 | 改良策略 v2（唯一配對 + 時窗調整） |

## 8. 責任聲明 / Disclaimer
- 本工具結果僅供內部營運決策參考，不構成對外承諾。
- LLM 評估具一定主觀性，須搭配人工抽樣驗證。
- 若使用環境非預期修改（DOM 結構/權限策略），導致統計偏差，不承擔對外責任；應回報並修復後再引用數據。

## 9. 推薦後續強化 (Internal TODO)
- [ ] 增加 LLM 評估輸出 schema 驗證模組
- [ ] 指數退避與逾時封裝 fetch 層
- [ ] 問答配對策略 v2：一對一 & 誤配衝突檢測
- [ ] IndexedDB 永續化 + 版本遷移流程文件
- [ ] 匯出 CSV 自動化單元測試（依 JSON Schema）
- [ ] 匿名化管線（hash userId -> uid_xxxx）
- [ ] KPI 差異報告（週比 / 範圍比）
- [ ] 異常閾值警示（Slack / Email Webhook）

## 10. 檔案間關聯
| 文件 | 目的 | 關聯 |
|------|------|------|
| README | 對外/一般內部維運說明 | 與 CHANGELOG 同步；列出高層架構與欄位定義 |
| CHANGELOG | 版本演進紀錄 | 驗證發布內容與文件一致性 |
| INTERNAL_USE.md | 合規/安全與內部治理 | 規範資料與權限邊界 |
| Security-Guidelines_Traditional-Chinese.md | 一般安全守則 | 本文件引用其原則，不重複列舉 |

## 11. 檔頭警語
```
# Internal Use Only - 此 CSV 僅供內部分析，不得外流或提供第三方。
# 若需對外呈現，請先去識別並通過主管與資安審核。
```

---
最後更新：2025-09-12
維護責任人：<yalkyao@mitac.com.tw>
